---
import { Image } from "astro:assets";
import HeroImg from "@/hero.png";
import { QUOTE, SITE_TITLE } from "@/consts";
---

<section
  class="min-h-screen !z-[20] relative w-full px-4 py-8 md:py-0"
  id="hero"
>
  <!-- Mobile Layout: Vertical -->
  <div class="flex flex-col justify-center items-center h-full md:hidden">
      <div class="text-center mb-8">
        <h1 class="font-bold text-5xl sm:text-6xl hover:glitch-effect transition-all duration-300">{`<${SITE_TITLE} />`}</h1>
        <h2 class="text-xl sm:text-2xl opacity-90 mt-3 font-medium text-muted-foreground min-h-[1.5em] flex justify-center items-center">
          <span id="hero-quote" class="font-mono">{QUOTE}</span>
           <span class="animate-pulse ml-1 text-accent">_</span>
        </h2>
      </div>

    <div class="w-full max-w-md sm:max-w-lg">
      <div class="hero-image-container mx-auto" id="hero-image-container">
        <Image
          alt="Hero"
          src={HeroImg}
          class="hero-mask-image w-full scale-100"
          id="hero-image"
        />
        <div class="hero-gradient-overlay"></div>
      </div>
      <div class="text-center mt-2 text-sm">
        <a
          href="https://www.instagram.com/howtoeatart"
          class="hover:text-accent transition-colors"
        >
          Profile picture by @howtoeatart
        </a>
      </div>
    </div>
  </div>

  <!-- Desktop Layout: Side by Side -->
  <div class="hidden md:grid md:grid-cols-2 md:gap-4 md:items-center md:h-full">
    <div class="grid place-items-center">
      <div class="text-center">
        <h1 class="font-bold text-7xl lg:text-8xl hover:glitch-effect transition-all duration-300">{`<${SITE_TITLE} />`}</h1>
        <h2 class="text-3xl opacity-90 mt-4 font-medium text-muted-foreground min-h-[1.5em] flex justify-center items-center">
          <span id="hero-quote-desktop" class="font-mono">{QUOTE}</span>
          <span class="animate-pulse ml-1 text-accent">_</span>
        </h2>
      </div>
    </div>

    <div>
      <div
        class="hero-image-container max-w-lg lg:max-w-xl xl:max-w-2xl mx-auto"
        id="hero-image-container-desktop"
      >
        <Image
          alt="Hero"
          src={HeroImg}
          class="hero-mask-image w-full scale-100"
          id="hero-image-desktop"
        />
        <div class="hero-gradient-overlay"></div>
      </div>
      <div class="text-center mt-2 text-sm">
        <a
          href="https://www.instagram.com/howtoeatart"
          class="hover:text-accent transition-colors"
        >
          Profile picture by @howtoeatart
        </a>
      </div>
    </div>
  </div>
  </div>
  
  <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 animate-bounce cursor-pointer opacity-70 hover:opacity-100 transition-opacity" onclick="document.getElementById('myposts').scrollIntoView({behavior: 'smooth'})">
    <svg 
      xmlns="http://www.w3.org/2000/svg" 
      class="h-10 w-10 text-muted-foreground" 
      fill="none" 
      viewBox="0 0 24 24" 
      stroke="currentColor"
    >
      <path 
        stroke-linecap="round" 
        stroke-linejoin="round" 
        stroke-width="2" 
        d="M19 14l-7 7m0 0l-7-7m7 7V3" 
      />
    </svg>
  </div>
</section>

<script is:inline>
  function initializeHeroMask() {
    const heroImage = document.getElementById("hero-image");
    const heroContainer = document.getElementById("hero-image-container");
    const gradientOverlay = document.querySelector(".hero-gradient-overlay");

    console.log("Initializing hero mask...", {
      heroImage,
      heroContainer,
      gradientOverlay,
    });

    if (!heroImage || !heroContainer || !gradientOverlay) {
      console.log("Missing elements, retrying in 100ms...");
      setTimeout(initializeHeroMask, 100);
      return;
    }

    function applyMask() {
      // Wait for image to be fully loaded
      if (heroImage.complete && heroImage.naturalHeight !== 0) {
        const imageSrc = heroImage.src;
        console.log("Applying mask with image:", imageSrc);

        // Set the CSS custom property
        document.documentElement.style.setProperty(
          "--hero-mask",
          `url(${imageSrc})`,
        );

        // Apply the mask-applied class to show the gradient
        gradientOverlay.classList.add("mask-applied");

        console.log("Mask applied successfully");
      } else {
        console.log("Image not ready, waiting...");
        heroImage.onload = applyMask;
        // Fallback timeout
        setTimeout(applyMask, 500);
      }
    }

    // Try to apply mask immediately
    applyMask();

    // Also set up onload handler in case image isn't ready
    heroImage.onload = applyMask;
  }

  // Initialize on DOM ready
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initializeHeroMask);
  } else {
    initializeHeroMask();
  }

  // Handle Astro navigation
  document.addEventListener("astro:page-load", () => {
    console.log("Astro page load detected");
    setTimeout(initializeHeroMask, 100);
  });

  // Handle visibility changes
  document.addEventListener("visibilitychange", () => {
    if (!document.hidden) {
      console.log("Page became visible");
      setTimeout(initializeHeroMask, 100);
    }
  });
</script>
