---
import { SITE_TITLE, NAV_LINKS as links } from "@/consts";
---

<nav
  class="w-full !z-[9999] py-3 md:py-5 px-3 md:px-4 bg-background/90 backdrop-blur-sm"
>
  <div
    class="w-full flex flex-col md:flex-row items-center justify-between gap-3 md:gap-4"
  >
    <a href="/" class="flex-shrink-0">
      <div
        id="logo"
        class="pt-2 pb-1 !grid !place-items-center select-none leading-none hover:bg-background bg-foreground scale-110 hover:text-foreground text-background px-3 md:px-4 transition-all ease-in-out text-sm md:text-base"
      >
        {SITE_TITLE}
      </div>
    </a>
    <div class="flex flex-wrap gap-2 md:gap-4 justify-center items-center">
      <div class="hidden md:block">/</div>
      {
        links.map((link) => {
          const href =
            link.href ?? link.title.toLowerCase().replaceAll(" ", "-");
          const pathname = Astro.url.pathname.replace(
            import.meta.env.BASE_URL,
            "",
          );
          const subpath = pathname.match(/[^\/]+/g);
          const isActive =
            href === pathname || href === "/" + (subpath?.[0] || "");
          
          if (link.children) {
            return (
              <>
                <div class="group relative px-2 py-1">
                  <button class="hover:text-accent-foreground transition-all ease-in-out text-sm md:text-base flex items-center justify-center gap-1">
                    {link.title}
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="transition-transform group-hover:rotate-180"
                    >
                      <path d="m6 9 6 6 6-6" />
                    </svg>
                  </button>
                  <div class="absolute left-1/2 -translate-x-1/2 top-full pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 min-w-[200px]">
                    <div class="bg-background/95 backdrop-blur-sm border border-border/50 rounded-lg shadow-lg overflow-hidden p-1 flex flex-col gap-1">
                      {link.children.map((child) => (
                        <a
                          href={`/${child.href}`}
                          class="block px-4 py-2 hover:bg-accent hover:text-accent-foreground rounded-md text-sm transition-colors text-center"
                        >
                          {child.title}
                        </a>
                      ))}
                    </div>
                  </div>
                </div>
                <div class="hidden md:block">/</div>
              </>
            );
          }

          return (
            <>
              <a
                class:list={[{ "bg-accent text-accent-foreground": isActive }]}
                class="hover:bg-accent hover:text-accent-foreground transition-all ease-in-out px-2 py-1 max-w-fit text-sm md:text-base flex items-center justify-center"
                href={`/${href}`}
              >
                <div>{link.title}</div>
              </a>
              <div class="hidden md:block">/</div>
            </>
          );
        })
      }
    </div>
  </div>
</nav>

<script>
  window.addEventListener("scroll", () => {
    const logo = document.getElementById("logo");
    if (!logo) return;
    if (window.scrollY > 100) {
      logo.className =
        "pt-2 pb-1 !grid !place-items-center select-none leading-none hover:bg-foreground bg-background scale-100 hover:text-background text-foreground px-3 md:px-4 transition-all ease-in-out text-sm md:text-base";
    } else {
      logo.className =
        "pt-2 pb-1 !grid !place-items-center select-none leading-none hover:bg-background bg-foreground scale-110 hover:text-foreground text-background px-3 md:px-4 transition-all ease-in-out text-sm md:text-base";
    }
  });
</script>
